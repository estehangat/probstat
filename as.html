<!DOCTYPE html>
<html>
  <head>
    <title>Regresi Linear Sederhana</title>
    <link rel="stylesheet" href="style.css" />
    <script>
      window.onload = function () {
        const svg = document.getElementById("svg");
        const button = document.getElementById("button");

        let dataPoints = [];

        button.onclick = function () {
          const x = parseFloat(document.getElementById("x").value);
          const y = parseFloat(document.getElementById("y").value);
          if (isNaN(x) || isNaN(y)) {
            console.error(
              "Invalid input: Please ensure both x and y are numbers."
            );
            return;
          }
          dataPoints.push({ x: x, y: y });
          console.log("Data points:", dataPoints);
          draw();
        };

        function draw() {
          svg.innerHTML = ""; // Clear SVG
          drawScatter();
          if (dataPoints.length > 1) {
            drawRegressionLine();
          }
        }

        function drawScatter() {
          dataPoints.forEach((point) => {
            const circle = document.createElementNS(
              "http://www.w3.org/2000/svg",
              "circle"
            );
            circle.setAttribute("cx", point.x);
            circle.setAttribute("cy", 400 - point.y); // Adjust for SVG coordinate system
            circle.setAttribute("r", 5);
            circle.setAttribute("fill", "blue");
            svg.appendChild(circle);

            const text = document.createElementNS(
              "http://www.w3.org/2000/svg",
              "text"
            );
            text.setAttribute("x", point.x + 10);
            text.setAttribute("y", 400 - point.y);
            text.textContent = `(${point.x}, ${point.y})`;
            svg.appendChild(text);
          });
        }

        function drawRegressionLine() {
          const { m, b } = calculateRegressionCoefficients(dataPoints);
          console.log("Slope (m):", m, "Intercept (b):", b);

          const xValues = dataPoints.map((p) => p.x);
          const minX = Math.min(...xValues);
          const maxX = Math.max(...xValues);

          const minY = m * minX + b;
          const maxY = m * maxX + b;

          const line = document.createElementNS(
            "http://www.w3.org/2000/svg",
            "line"
          );
          line.setAttribute("x1", minX);
          line.setAttribute("y1", 400 - minY); // Adjust for SVG coordinate system
          line.setAttribute("x2", maxX);
          line.setAttribute("y2", 400 - maxY); // Adjust for SVG coordinate system
          line.setAttribute("stroke", "red");
          svg.appendChild(line);
        }

        function calculateRegressionCoefficients(data) {
          let sumX = 0,
            sumY = 0,
            sumXY = 0,
            sumXX = 0;
          const N = data.length;

          data.forEach((point) => {
            sumX += point.x;
            sumY += point.y;
            sumXY += point.x * point.y;
            sumXX += point.x * point.x;
          });

          const m = (N * sumXY - sumX * sumY) / (N * sumXX - sumX * sumX);
          const b = (sumY - m * sumX) / N;

          return { m, b };
        }
      };
    </script>
  </head>
  <body>
    <h2 id="judul">Regresi Linear Sederhana</h2>
    <table id="text">
      <th>Persamaan</th>
      <th>Persamaan Konstanta a dan b</th>
      <tr>
        <td><img src="/assets/persamaan.png" height="175px" /></td>
        <td><img src="/assets/konstanta-ab.png" height="175px>"</td>
      </tr>
    </table>
    <br />
    <div id="input">
      <label for="x">Nilai X :</label>
      <input type="number" id="x" name="x" />
      <label for="y">Nilai Y :</label>
      <input type="number" id="y" name="y" />
      <button id="button" onclick="draw()">Hitung</button>
    </div>
    <br />
    <svg
      id="svg"
      width="500"
      height="400"
      style="border: 1px solid black"
    ></svg>
  </body>
</html>
